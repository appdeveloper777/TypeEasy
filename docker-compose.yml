services:
  # --- SERVICIO DE LA API WEB (Sin cambios) ---
  api:
    build:
      context: .
      dockerfile: src/Dockerfile
      target: api
    image: typeeasy-api
    ports:
      - "8080:8080"  
    environment:
      - TYPEEASY_DEBUG=0  
  
  # --- SERVICIO DEL INTÉRPRETE (Sin cambios) ---
  typeeasy:
    build:
      context: .
      dockerfile: src/Dockerfile
      target: typeeasy
    volumes:
      - ./typeeasycode:/code
    environment:
      - TYPEEASY_DEBUG=0
    working_dir: /code
    entrypoint: ["/typeeasy/typeeasy"]

  # --- ¡NUEVO! SERVICIO DEL AGENTE (n8n) ---
  agent:
    build:
      context: .
      dockerfile: src/Dockerfile
      target: agent # Apunta a la nueva etapa 6 del Dockerfile
    image: typeeasy-agent
    ports:
      - "8081:8081" # Expone el puerto del agente
    volumes:
      # ARREGLO: Monta solo el script, no toda la carpeta /app
      - ./typeeasycode/agente_chat_whatsapp.te:/app/agente_chat_whatsapp.te
    environment:
      - TYPEEASY_DEBUG=0
    # El CMD del Dockerfile ya es ["./servidor_agent", "agente_chat_whatsapp.te"]