// 1. Bridges (OK)
bridge Chat = WhatsApp.connect("api_key_wa_001");
bridge NLU = Rust.import("motor_nlu_local");
bridge API = Http.client("https://api.elsabor.com");

// 2. Agente (OK)
agent PedidosBot {

    // 3. Listener (OK)
    listener Chat.onMessage(mensaje) {
     
        // 4. Declaraciones (OK)
        state sesion = Chat.getSession(mensaje.userId);
        node intencion = NLU.parse(mensaje.text);
        
        // 5. Lógica de 'match' (¡Esto causará el error!)
        match (intencion.tipo) {
            case "saludar":
                Chat.reply(mensaje.user, "¡Hola!");
                sesion.paso = "inicio";
            case "pedirMenu":
                node menu = API.get("/menu");
                Chat.reply(mensaje.user, "Claro, aquí está el menú: {menu.formato_texto}");
                sesion.paso = "viendo_menu";
            case "agregarItem":
                node item = intencion.entidad["item"];
                node cantidad = intencion.entidad["cantidad"];
               // sesion.pedido.add({ item: item, cant: cantidad });
                Chat.reply(mensaje.user, "¡Añadido! ¿Algo más?");
                sesion.paso = "armando_pedido";
                println("Item agregado al pedido:");
        }
    }
}